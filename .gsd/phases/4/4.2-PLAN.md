---
phase: 4
plan: 2
wave: 1
---

# Plan 4.2: PROJECTS Sheet & initStructure Update

## Objective
Create the PROJECTS sheet with its structure, update `initStructure()` to create it, and ensure TASKS gets the new expanded headers (Proyecto, ID).

## Context
- Config.gs (HEADERS_PROJECTS, SHEET_PROJECTS, HEADERS_TASKS updated in 4.1)
- Main.gs (initStructure function)
- Helpers.gs (generateTaskId_ from 4.1)

## Tasks

<task type="auto">
  <name>Update initStructure for new model</name>
  <files>Main.gs</files>
  <action>
    1. In `initStructure()`, add a block to create the PROJECTS sheet:
       - Check if `SHEET_PROJECTS` exists; if not, create it.
       - Write `HEADERS_PROJECTS` as row 1 header, bold.
    2. Update the TASKS sheet initialization:
       - If TASKS header row is empty, write the updated `HEADERS_TASKS` (which now includes Proyecto and ID).
       - **Do NOT overwrite** existing TASKS headers if they already exist (existing data protection).
    3. Add Estado data validation to TASKS sheet:
       - Apply dropdown validation to the Estado column using `VALID_STATUSES`.
       - Use `getHeaderMap_()` to find the Estado column index dynamically.
    4. Clean up: remove the leftover placeholder comment block (lines 57-62 in current Main.gs).
  </action>
  <verify>Select-String -Path Main.gs -Pattern "SHEET_PROJECTS|VALID_STATUSES|getHeaderMap_"</verify>
  <done>initStructure creates PROJECTS sheet and applies Estado validation.</done>
</task>

<task type="auto">
  <name>Add menu item for PROJECTS management</name>
  <files>Main.gs</files>
  <action>
    1. In `onOpen()`, add a separator and a submenu or item:
       `.addSeparator()`
       `.addItem('Gestionar proyectos', 'manageProjects')`
    2. Create placeholder function `manageProjects()`:
       - Opens a UI alert listing current projects from the PROJECTS sheet.
       - Reads PROJECTS data and shows project names + status.
       - This is a simple v1 â€” sidebar will come in Phase 8.
  </action>
  <verify>Select-String -Path Main.gs -Pattern "manageProjects|Gestionar proyectos"</verify>
  <done>Menu includes project management entry point.</done>
</task>

## Success Criteria
- [ ] `initStructure()` creates PROJECTS sheet with correct headers.
- [ ] Estado column gets dropdown validation from `VALID_STATUSES`.
- [ ] Menu includes "Gestionar proyectos" item.
