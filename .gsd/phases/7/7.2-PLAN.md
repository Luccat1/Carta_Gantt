---
phase: 7
plan: 2
wave: 1
---

# Plan 7.2: Filtered Views (By Project & By Responsible)

## Objective
Add two new menu-triggered functions that generate filtered task views: one grouped by project and another grouped by responsible person. These are written to a single `VIEWS` sheet with distinct sections, giving managers quick access to "who is doing what" and "what does each project look like."

## Context
- Config.gs (sheet constants, HEADERS_TASKS)
- Gantt.gs (pattern for reading/writing sheet data)
- Main.gs (initStructure, onOpen menu)
- Helpers.gs (getHeaderMap_, getColIndex_)

## Tasks

<task type="auto">
  <name>Add VIEWS sheet and menu items</name>
  <files>Config.gs, Main.gs</files>
  <action>
    1. In `Config.gs`, add `var SHEET_VIEWS = 'VIEWS';`.
    2. In `Main.gs` > `initStructure`:
       - Ensure VIEWS sheet exists (same pattern).
       - Apply warning-only protection.
    3. In `Main.gs` > `onOpen`:
       - Add a submenu "Vistas" with two items:
         - "Vista por Proyecto" ‚Üí `viewByProject`
         - "Vista por Responsable" ‚Üí `viewByResponsible`
       - Place under the main "Gantt ‚öôÔ∏è" menu as a submenu.
  </action>
  <verify>grep "SHEET_VIEWS" Config.gs && grep "viewByProject" Main.gs</verify>
  <done>VIEWS sheet created by initStructure. Menu has submenu with both view options.</done>
</task>

<task type="auto">
  <name>Implement viewByProject and viewByResponsible</name>
  <files>Gantt.gs</files>
  <action>
    1. Create `viewByProject()` in `Gantt.gs`:
       - Clear VIEWS sheet.
       - Read all tasks via header-map.
       - Group tasks by `Proyecto` column.
       - For each group:
         - Write a header row: "üìÅ [ProjectName]" (bold, merged across 6 cols).
         - Write column headers: Tarea | Responsable | Inicio | Fin | Estado
         - Write each task's data.
         - Add an empty separator row.
       - Alert: "Vista por proyecto generada."

    2. Create `viewByResponsible()` in `Gantt.gs`:
       - Same pattern as viewByProject but grouping by `Responsable` column.
       - Header per group: "üë§ [ResponsableName]"
       - Write column headers: Proyecto | Tarea | Inicio | Fin | Estado
       - Alert: "Vista por responsable generada."

    3. Both functions should:
       - Sort tasks within each group by Inicio date (ascending).
       - Skip empty rows (no Tarea name).
       - Handle tasks with empty Proyecto or Responsable by grouping them under "Sin asignar".

    - The VIEWS sheet is a READ-ONLY snapshot, not a live formula view. Each call rebuilds from scratch.
  </action>
  <verify>grep "viewByProject" Gantt.gs && grep "viewByResponsible" Gantt.gs</verify>
  <done>Both view functions populate VIEWS with grouped, sorted task data. Groups have clear visual separators.</done>
</task>

## Success Criteria
- [ ] VIEWS sheet is created by initStructure
- [ ] `viewByProject` groups tasks under project headers
- [ ] `viewByResponsible` groups tasks under responsible headers
- [ ] Tasks are sorted by start date within groups
- [ ] "Sin asignar" group handles null values
- [ ] Menu submenu "Vistas" contains both options
