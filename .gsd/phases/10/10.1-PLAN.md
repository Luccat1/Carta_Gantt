---
phase: 10
plan: 1
wave: 1
---

# Plan 10.1: Google Calendar Sync

## Objective
Enable syncing task deadlines from TASKS to a Google Calendar. Users can push upcoming tasks as calendar events, making deadlines visible in their Calendar app and on mobile.

## Context
- Config.gs ‚Äî Sheet constants, HEADERS_TASKS
- Main.gs ‚Äî onOpen menu, initStructure
- Helpers.gs ‚Äî getHeaderMap_, getColIndex_

## Tasks

<task type="auto">
  <name>Create CalendarSync.gs with syncTasksToCalendar function</name>
  <files>CalendarSync.gs (NEW)</files>
  <action>
    1. Create `CalendarSync.gs` with a `syncTasksToCalendar()` function:
       a. Prompt user for a calendar name via `ui.prompt()`. Default: 'Gantt - Tareas'.
       b. Get or create the calendar using `CalendarApp.getCalendarsByName()` / `CalendarApp.createCalendar()`.
       c. Read all rows from TASKS sheet using `getHeaderMap_`.
       d. For each task with valid Inicio/Fin dates and Estado != 'Terminado' and != 'Cancelado':
          - Check if an event with the same title already exists in the date range (to avoid duplicates).
          - If not, create an all-day event: `calendar.createAllDayEvent(taskName, startDate, endDate)`.
          - Set event description to: "Proyecto: {proyecto}\nResponsable: {responsable}\nEstado: {estado}".
          - Set event color based on Estado:
            - 'Bloqueado' ‚Üí CalendarApp.EventColor.RED
            - 'En curso' ‚Üí CalendarApp.EventColor.CYAN
            - 'No iniciado' ‚Üí CalendarApp.EventColor.YELLOW
       e. Show summary alert: "X eventos creados/actualizados en calendario '{name}'."
    2. Add error handling with try/catch around CalendarApp calls.
    3. Do NOT use the default calendar ‚Äî always use a dedicated named calendar.
  </action>
  <verify>Code review: syncTasksToCalendar exists with duplicate detection and color coding</verify>
  <done>Tasks can be synced to a dedicated Google Calendar with color-coded events</done>
</task>

<task type="auto">
  <name>Add Calendar menu item</name>
  <files>Main.gs</files>
  <action>
    1. In Main.gs `onOpen()`: Add menu item "üìÖ Sincronizar con Calendar" calling `syncTasksToCalendar`.
    2. Place it after the "‚ö° Configurar trigger AppSheet" item.
  </action>
  <verify>Code review: menu item added</verify>
  <done>Calendar sync accessible from Gantt menu</done>
</task>

## Success Criteria
- [ ] syncTasksToCalendar creates events in a named calendar
- [ ] Duplicate events are not created on re-sync
- [ ] Event colors reflect task status
- [ ] Menu item added to Gantt ‚öôÔ∏è
