---
phase: 10
plan: 3
wave: 2
---

# Plan 10.3: Gmail Notifications

## Objective
Send email notifications for tasks that are overdue or upcoming (within N days). Uses MailApp to avoid Gmail API quota complexity.

## Context
- Config.gs ‚Äî HEADERS_TASKS, SHEET_TASKS
- Main.gs ‚Äî onOpen menu
- Helpers.gs ‚Äî getHeaderMap_, getColIndex_

## Tasks

<task type="auto">
  <name>Create Notifications.gs with sendTaskAlerts function</name>
  <files>Notifications.gs (NEW)</files>
  <action>
    1. Create `Notifications.gs` with a `sendTaskAlerts()` function:
       a. Define alert window: tasks overdue OR due within next 3 days.
       b. Read all rows from TASKS sheet.
       c. For each task:
          - Parse Fin date.
          - Skip if Estado is 'Terminado' or 'Cancelado'.
          - If Fin < today ‚Üí overdue.
          - If Fin is within 3 days from today ‚Üí upcoming.
       d. Group alerts by Responsable.
       e. For each Responsable with alerts:
          - If Responsable column contains an email (@ symbol), use it as recipient.
          - Otherwise, send all alerts to the spreadsheet owner (`Session.getActiveUser().getEmail()`).
       f. Build HTML email body:
          - Subject: "üîî Alertas Gantt: {N} tareas requieren atenci√≥n"
          - Body sections:
            - üî¥ Tareas vencidas (with task name, project, days overdue)
            - üü° Tareas pr√≥ximas a vencer (with task name, project, days remaining)
          - Footer: link to the spreadsheet.
       g. Send using `MailApp.sendEmail({to, subject, htmlBody})`.
       h. Show summary alert: "Notificaciones enviadas a X destinatarios."
    2. Create `sendTaskAlertsPreview()` that builds the same email but shows it in a dialog instead of sending, for testing.
    3. Add error handling ‚Äî catch individual email failures but continue with the rest.
  </action>
  <verify>Code review: sendTaskAlerts and preview function exist with overdue/upcoming logic</verify>
  <done>Email alerts sent for overdue and upcoming tasks</done>
</task>

<task type="auto">
  <name>Add notification menu items and update docs</name>
  <files>Main.gs, README.md</files>
  <action>
    1. In Main.gs `onOpen()`: Add two menu items:
       - "üìß Enviar alertas por email" calling `sendTaskAlerts`
       - "üëÅÔ∏è Preview de alertas" calling `sendTaskAlertsPreview`
    2. Place them after the Drive folder item.
    3. In README.md, add a new section "## üîó Integraciones Google Suite" documenting:
       - Calendar sync: push deadlines to Google Calendar.
       - Drive folders: auto-create project folder structure.
       - Gmail alerts: email notifications for overdue/upcoming tasks.
  </action>
  <verify>Code review: menu items and README section added</verify>
  <done>Notification system accessible and documented</done>
</task>

## Success Criteria
- [ ] sendTaskAlerts identifies overdue and upcoming tasks
- [ ] Emails sent with HTML body grouped by responsable
- [ ] Preview function shows email in dialog without sending
- [ ] Menu items added to Gantt ‚öôÔ∏è
- [ ] README documents all Google Suite integrations
