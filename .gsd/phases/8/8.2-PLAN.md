---
phase: 8
plan: 2
wave: 1
---

# Plan 8.2: Sidebar "Nueva Tarea" (HTML Form)

## Objective
Create an HTML sidebar that lets users quickly add a new task to the TASKS sheet without manually navigating to the correct row. The form uses dropdowns for Project and Estado, date pickers for Inicio/Fin, and text fields for the rest.

## Context
- .gsd/SPEC.md
- Config.gs — HEADERS_TASKS, VALID_STATUSES, SHEET_TASKS, SHEET_PROJECTS
- Main.gs — onOpen menu
- Helpers.gs — getHeaderMap_, getColIndex_, generateTaskId_

## Tasks

<task type="auto">
  <name>Create Sidebar.html with task form</name>
  <files>Sidebar.html (NEW)</files>
  <action>
    Create `Sidebar.html` with:
    1. A styled HTML form with fields matching HEADERS_TASKS:
       - Proyecto: dropdown (populated from PROJECTS sheet via google.script.run)
       - ID: auto-generated (hidden, filled by script)
       - Area, Tarea, Subarea: text inputs
       - Responsable, Ejecuta: text inputs
       - Inicio, Fin: date inputs (type="date")
       - Estado: dropdown with VALID_STATUSES values
       - Etiquetas, Material: text inputs
    2. A "Guardar" button that calls `google.script.run.addTaskFromSidebar(formData)`
    3. A "Cerrar" button that calls `google.script.host.close()`
    4. Basic CSS styling (clean, modern, matching Google Sheets aesthetics)
    5. Success/error feedback via a status message div
    - Use `google.script.run.withSuccessHandler().withFailureHandler()` pattern
    - On success, clear the form and show "Tarea creada" message
  </action>
  <verify>HTML file exists with all fields, script calls, and styling</verify>
  <done>Sidebar.html created with complete form and client-side logic</done>
</task>

<task type="auto">
  <name>Add server-side functions and menu integration</name>
  <files>Main.gs</files>
  <action>
    1. Add `showNewTaskSidebar()` function that:
       - Opens Sidebar.html via HtmlService.createHtmlOutputFromFile('Sidebar').setTitle('Nueva Tarea')
       - Shows it with SpreadsheetApp.getUi().showSidebar()
    2. Add `getProjectNames()` function that returns an array of project names (for populating the dropdown)
    3. Add `getValidStatuses()` function that returns VALID_STATUSES array
    4. Add `addTaskFromSidebar(formData)` function that:
       - Generates ID via generateTaskId_()
       - Appends a new row to TASKS sheet matching HEADERS_TASKS column order
       - Returns success message
    5. In `onOpen()`, add menu item "➕ Nueva tarea" calling `showNewTaskSidebar`
  </action>
  <verify>Code review: all 4 server functions exist, menu item added</verify>
  <done>Sidebar opens from menu, form submits data to TASKS sheet correctly</done>
</task>

## Success Criteria
- [ ] Sidebar opens from the "Gantt ⚙️" menu
- [ ] Form populates Project dropdown from PROJECTS sheet
- [ ] Submitting the form appends a correct row to TASKS
- [ ] Form shows success feedback and clears after submission
