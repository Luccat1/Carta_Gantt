---
phase: 2
plan: 2
wave: 1
---

# Plan 2.2: Gantt Conditional Formatting

## Objective
Implement `applyOverlapConditionalFormatting_()` to visualize task duration as bars in the `GANTT_VIEW` grid.

## Context
- .gsd/SPEC.md (REQ-04)
- Gantt.gs (2.1-PLAN.md)
- Main.gs

## Tasks

<task type="auto">
  <name>Implement Conditional Formatting</name>
  <files>Gantt.gs</files>
  <action>
    Add `applyOverlapConditionalFormatting_(sheet, numStaticCols, weekData)` to `Gantt.gs`.
    - Purpose: Generate and apply formatting rules for the grid area (Week columns x Task rows).
    - Logic:
      - Start Range: Grid area starting from (Row 2, Column `numStaticCols` + 1).
      - Formula: `AND($StartColRow <= WeekEnd, $EndColRow >= WeekStart)`
      - **CRITICAL FIX (REQ-04)**: Use absolute column / relative row references for task Start (F) and End (G) dates.
        - Example formula: `=AND($F2<=M$1, $G2>=L$1)` where M$1 is Week End and L$1 is Week Start (dates hidden in headers or referenced from lookup).
        - **Simpler Logic**: Since `LOOKUPS` defines week Start/End, we can iterate columns and set rules per column OR use a sophisticated formula referencing helper cells.
        - **Chosen Approach**: Iterate WEEK COLUMNS. For each week column `j`:
          - Get strict Week Start/End/Start (Mon-Sun).
          - Define formula for that whole column: `=AND($F2<=DATE(Y,M,D_End), $G2>=DATE(Y,M,D_Start))`
          - Apply background color.
          - This avoids complex indirect referencing issues.
    - Call this function at the end of `refreshGanttView`.
  </action>
  <verify>Select-String -Path Gantt.gs -Pattern "function applyOverlapConditionalFormatting_"</verify>
  <done>Conditional formatting logic exists and is called.</done>
</task>

## Success Criteria
- [ ] Formatting is applied column-by-column or via grid.
- [ ] Logic respects correct Date comparisons.
- [ ] Visual bars appear correctly.
