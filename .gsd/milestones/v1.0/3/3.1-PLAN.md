---
phase: 3
plan: 1
wave: 1
---

# Plan 3.1: Annual Rollover Logic

## Objective
Implement `rolloverToNextYear()` to safely transition the project to the next year by archiving completed tasks and resetting the calendar.

## Context
- .gsd/SPEC.md (REQ-05)
- Main.gs
- Config.gs

## Tasks

<task type="auto">
  <name>Implement Rollover Logic</name>
  <files>Rollover.gs, Main.gs</files>
  <action>
    1. Create `Rollover.gs`.
       - Implement `rolloverToNextYear()`.
       - **Logic**:
         - Read Current Year from `CONFIG` (B1).
         - Calculate `NextYear = CurrentYear + 1`.
         - Confirm with user (UI Alert/Prompt) - *Note: Scripts can't easily wait for prompt in this flow, so we'll assume confirmed or just implement the logic to be attached to the UI.*
         - **Archive**:
           - Create new sheet `ARCHIVE_{CurrentYear}`.
           - Copy header from `TASKS`.
           - Filter `TASKS`:
             - If `Fin` < `Jan 1, {NextYear}`, move to Archive.
             - Else, keep in `TASKS`.
           - Write Archive rows to new sheet.
           - Clear `TASKS` data range and write back only remaining tasks.
         - **Update Config**:
           - Set CONFIG B1 to `NextYear`.
           - Set CONFIG B2 to 1 (January).
         - **Regenerate**:
           - Call `buildCalendarFromConfig()`.
           - Call `refreshGanttView()`.
    2. Update `Main.gs`:
       - Remove placeholder `rolloverToNextYear`.
       - Ensure menu points to new function.
  </action>
  <verify>test-path Rollover.gs; Select-String -Path Rollover.gs -Pattern "function rolloverToNextYear"</verify>
  <done>Rollover logic implemented with archiving and config update.</done>
</task>

## Success Criteria
- [ ] Old tasks are moved to `ARCHIVE_YYYY`.
- [ ] `TASKS` sheet is cleaned up.
- [ ] Config Year is incremented.
