---
phase: 4
plan: 1
wave: 1
---

# Plan 4.1: Header-Map Utility & Config Expansion

## Objective
Create a header-map utility that resolves column indices by header name, eliminating all hardcoded index dependencies. Expand `Config.gs` with new sheet names, enums, and updated TASKS headers.

## Context
- Config.gs (current constants)
- Gantt.gs (uses `HEADERS_TASKS.length`, `$F2`/`$G2` hardcoded)
- Calendar.gs (uses `SHEET_CONFIG`, `SHEET_LOOKUPS`)
- Rollover.gs (uses `row[6]` hardcoded for End Date)
- Validation.gs (uses `row[1]`, `row[5]`, `row[6]` hardcoded)

## Tasks

<task type="auto">
  <name>Expand Config.gs with new constants</name>
  <files>Config.gs</files>
  <action>
    1. Add `SHEET_PROJECTS = 'PROJECTS'` constant.
    2. Update `HEADERS_TASKS` to include `'Proyecto'` as first column and move `'ID'` to second position:
       `['Proyecto', 'ID', 'Area', 'Tarea', 'Subarea', 'Responsable', 'Ejecuta', 'Inicio', 'Fin', 'Estado', 'Etiquetas', 'Material']`
    3. Add `HEADERS_PROJECTS` array:
       `['ProyectoID', 'Nombre', 'Owner', 'Inicio', 'Fin', 'Estado', 'Color']`
    4. Add `VALID_STATUSES` enum array:
       `['No iniciado', 'En curso', 'Bloqueado', 'Terminado', 'Cancelado']`
    5. Add `DEFAULT_COLOR = '#4a86e8'`.
  </action>
  <verify>Select-String -Path Config.gs -Pattern "SHEET_PROJECTS|HEADERS_PROJECTS|VALID_STATUSES"</verify>
  <done>Config.gs contains all new constants for multi-project model.</done>
</task>

<task type="auto">
  <name>Create HeaderMap utility</name>
  <files>Helpers.gs</files>
  <action>
    1. Add function `getHeaderMap_(sheet)`:
       - Reads row 1 of the given sheet.
       - Returns an object mapping header names to 1-based column indices.
       - Example: `{Proyecto: 1, ID: 2, Area: 3, ...}`
    2. Add function `getColIndex_(headerMap, colName)`:
       - Returns the 1-based index from headerMap for the given colName.
       - Throws an error if colName is not found (defensive).
    3. Add function `generateTaskId_()`:
       - Generates a unique ID like `T-{timestamp}-{random4digits}`.
       - Used when creating new tasks.
  </action>
  <verify>Select-String -Path Helpers.gs -Pattern "function getHeaderMap_|function getColIndex_|function generateTaskId_"</verify>
  <done>Header-map utility and ID generator exist in Helpers.gs.</done>
</task>

## Success Criteria
- [ ] `HEADERS_TASKS` includes Proyecto and ID in correct positions.
- [ ] `HEADERS_PROJECTS` and `VALID_STATUSES` constants defined.
- [ ] `getHeaderMap_()` returns nameâ†’index mapping from any sheet's row 1.
- [ ] `generateTaskId_()` produces unique IDs.
