---
phase: 6
plan: 1
wave: 1
---

# Plan 6.1: Multi-Month Calendar Selector

## Objective
Extend the calendar system to support a configurable range of months instead of a single month. Currently `buildCalendarFromConfig` reads a single Año/Mes from CONFIG and generates 4 weeks. This plan adds a "MesFin" field to CONFIG so users can generate week columns spanning multiple consecutive months (e.g., March–June).

## Context
- Config.gs (CONFIG constants, defaults)
- Calendar.gs (`buildCalendarFromConfig`, reads CONFIG)
- Helpers.gs (`weeksOfMonth_`, `monthNameEs_`)
- Main.gs (`initStructure` — ensures CONFIG sheet)

## Tasks

<task type="auto">
  <name>Add MesFin to CONFIG and constants</name>
  <files>Config.gs, Main.gs</files>
  <action>
    1. In `Config.gs`, add `var DEFAULT_MONTH_END = DEFAULT_MONTH;` (default: same month as start → single-month behavior preserved).
    2. In `Main.gs` > `initStructure`, add row A3="MesFin", B3=DEFAULT_MONTH_END when creating CONFIG sheet. If CONFIG already exists but lacks A3, append the row (guard check).
    - Do NOT break existing single-month behavior — if MesFin is empty or equals Mes, system behaves exactly as before.
  </action>
  <verify>grep "DEFAULT_MONTH_END" Config.gs && grep "MesFin" Main.gs</verify>
  <done>CONFIG sheet has 3 rows: Año, Mes, MesFin. Default values preserve single-month behavior.</done>
</task>

<task type="auto">
  <name>Extend buildCalendarFromConfig for multi-month</name>
  <files>Calendar.gs</files>
  <action>
    1. Read B3 (MesFin) from CONFIG. If empty or less than Mes, default to Mes (single-month).
    2. Loop from `month` to `monthEnd`, calling `weeksOfMonth_` for each month and concatenating results.
    3. Handle year boundary: if MesFin < Mes, it means the range wraps into the next year (e.g., Nov–Feb). Increment year when month > 12.
    4. Write all accumulated week rows to LOOKUPS as before.
    5. Update the confirmation alert to show the range: "Calendario generado: mar 2026 – jun 2026".
    - Labels from `weeksOfMonth_` already include month prefix (e.g., "mar S1"), so multi-month labels will naturally be distinct.
  </action>
  <verify>Review Calendar.gs for loop logic from month to monthEnd with weeksOfMonth_ calls.</verify>
  <done>`buildCalendarFromConfig` generates week rows for all months in the range. Single-month still works when MesFin == Mes or is empty.</done>
</task>

## Success Criteria
- [ ] CONFIG sheet includes MesFin row (A3/B3)
- [ ] `buildCalendarFromConfig` loops through month range
- [ ] Single-month backward compatibility preserved
- [ ] LOOKUPS contains weeks for all months in range
