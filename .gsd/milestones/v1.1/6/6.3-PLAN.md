---
phase: 6
plan: 3
wave: 2
---

# Plan 6.3: TIMELINE_DATA Auto-Generation

## Objective
Create a `TIMELINE_DATA` sheet that auto-generates data formatted for Google Sheets' native Timeline chart. This provides a second visualization option alongside the custom GANTT_VIEW. The Timeline chart requires a specific data structure: [Row Label, Bar Label, Start Date, End Date].

## Context
- Config.gs (sheet constants, HEADERS_TASKS)
- Gantt.gs (`refreshGanttView` — similar pattern to follow)
- Main.gs (`initStructure` — sheet creation pattern)
- Helpers.gs (header-map utilities)

## Tasks

<task type="auto">
  <name>Add TIMELINE_DATA sheet and constants</name>
  <files>Config.gs, Main.gs</files>
  <action>
    1. In `Config.gs`, add `var SHEET_TIMELINE = 'TIMELINE_DATA';`.
    2. In `Config.gs`, add `var HEADERS_TIMELINE = ['Proyecto', 'Tarea', 'Inicio', 'Fin'];` — this matches the 4-column format Google Timeline chart expects.
    3. In `Main.gs` > `initStructure`:
       - Ensure TIMELINE_DATA sheet exists (same pattern as other sheets).
       - Set bold headers.
       - Apply warning-only protection (same pattern as GANTT_VIEW).
  </action>
  <verify>grep "SHEET_TIMELINE" Config.gs && grep "TIMELINE_DATA" Main.gs</verify>
  <done>TIMELINE_DATA sheet is created by initStructure with correct headers and protection.</done>
</task>

<task type="auto">
  <name>Implement refreshTimelineData function</name>
  <files>Gantt.gs, Main.gs</files>
  <action>
    1. Create `refreshTimelineData()` in `Gantt.gs`:
       - Clear TIMELINE_DATA (rows 2+).
       - Read all tasks from TASKS sheet using header-map.
       - For each valid task (has Proyecto, Tarea, valid Inicio/Fin):
         - Write row: [Proyecto, Tarea, Inicio, Fin].
       - Skip rows with missing dates or empty Tarea.
       - Alert user with count of rows written.
    2. In `Main.gs` > `onOpen`:
       - Add menu item "Refrescar Timeline" calling `refreshTimelineData`.
       - Place it after "Refrescar vista Gantt".
    3. Also call `refreshTimelineData` at the end of `refreshGanttView` — so both views stay in sync.
    - Do NOT embed a Chart object — the user will create their own Timeline chart pointing at TIMELINE_DATA. The function only prepares the data.
  </action>
  <verify>grep "refreshTimelineData" Gantt.gs && grep "refreshTimelineData" Main.gs</verify>
  <done>`refreshTimelineData` populates TIMELINE_DATA from TASKS. Menu item exists. Auto-called from refreshGanttView.</done>
</task>

## Success Criteria
- [ ] TIMELINE_DATA sheet created by initStructure
- [ ] `refreshTimelineData` populates 4-column data from TASKS
- [ ] Menu item "Refrescar Timeline" added
- [ ] Auto-sync: refreshGanttView also refreshes TIMELINE_DATA
- [ ] Invalid/incomplete rows are skipped
