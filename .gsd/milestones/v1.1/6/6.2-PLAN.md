---
phase: 6
plan: 2
wave: 1
---

# Plan 6.2: Project-Color Gantt Bars

## Objective
Replace the hardcoded blue Gantt bar color (`#4a86e8`) with dynamic per-project colors from the `PROJECTS.Color` column. Each task's bar in GANTT_VIEW should use its project's designated color. Tasks without a project color fall back to `DEFAULT_COLOR`.

## Context
- Config.gs (`HEADERS_PROJECTS` includes 'Color', `DEFAULT_COLOR`)
- Gantt.gs (`refreshGanttView`, `applyOverlapConditionalFormatting_`)
- Helpers.gs (header-map utilities)

## Tasks

<task type="auto">
  <name>Build project-color lookup map</name>
  <files>Gantt.gs</files>
  <action>
    1. Inside `refreshGanttView`, after reading TASKS data:
       - Read the PROJECTS sheet.
       - Build a `projectColorMap` object: `{ projectName: colorHex, ... }`.
       - Pass this map to `applyOverlapConditionalFormatting_`.
    2. If PROJECTS sheet doesn't exist or has no data, use an empty map (all tasks get DEFAULT_COLOR).
    - Use `getHeaderMap_` and `getColIndex_` to find 'Nombre' and 'Color' columns dynamically.
  </action>
  <verify>grep "projectColorMap" Gantt.gs</verify>
  <done>`refreshGanttView` builds a projectColorMap from PROJECTS and passes it downstream.</done>
</task>

<task type="auto">
  <name>Apply per-project colors in conditional formatting</name>
  <files>Gantt.gs</files>
  <action>
    1. Update `applyOverlapConditionalFormatting_` signature to accept `projectColorMap` and `tasksValues` (the actual row data from TASKS).
    2. Instead of creating one rule per week column with a single blue color, create one rule per (week × unique project color) combination:
       - For each unique color in the data, create a conditional format rule that matches rows where the Proyecto column equals a specific project AND the date overlaps the week.
       - This requires R1C1-style formulas referencing the Proyecto column.
    3. Fallback: tasks whose project has no color entry use `DEFAULT_COLOR`.
    - IMPORTANT: Google Sheets has a limit of ~100 conditional formatting rules. If there are many projects × weeks, batch by project (one rule per project covering all weeks via OR), not one per cell.
    - Alternative simpler approach: Instead of conditional formatting (which has limits), use direct cell background coloring. After writing task data, iterate over each task row and each week column. If the task overlaps the week, set the cell background to the project's color. This avoids the 100-rule limit entirely.
  </action>
  <verify>Review Gantt.gs for project color application logic (either conditional formatting or direct cell painting).</verify>
  <done>Gantt bars display in project-specific colors. Tasks without a project color use DEFAULT_COLOR.</done>
</task>

## Success Criteria
- [ ] Project color map is built from PROJECTS.Color
- [ ] Gantt bars reflect per-project colors
- [ ] Fallback to DEFAULT_COLOR when no project color is specified
- [ ] No regression in Gantt rendering for single-project or empty-PROJECTS scenarios
