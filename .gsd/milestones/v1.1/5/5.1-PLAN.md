---
phase: 5
plan: 1
wave: 1
---

# Plan 5.1: Data Validation Dropdowns & ISSUES Sheet

## Objective
Implement comprehensive data validation (dropdowns) across all sheets to minimize human error, and create an ISSUES sheet as the output target for the validation engine. This addresses the high-priority TODO about dropdowns.

## Context
- Config.gs — VALID_STATUSES, HEADERS_PROJECTS, HEADERS_TASKS
- Main.gs — initStructure() already applies Estado dropdown to TASKS
- Validation.gs — current validation logic (alert-based output)

## Tasks

<task type="auto">
  <name>Add SHEET_ISSUES constant and create ISSUES sheet in initStructure</name>
  <files>Config.gs, Main.gs</files>
  <action>
    1. In Config.gs, add `var SHEET_ISSUES = 'ISSUES';` after SHEET_GANTT.
    2. Add HEADERS_ISSUES array: `['Fecha', 'Hoja', 'Fila', 'Campo', 'Mensaje', 'Severidad']`.
    3. In Main.gs > initStructure(), add a block to ensure ISSUES sheet exists (with bold headers), after GANTT_VIEW.
  </action>
  <verify>Select-String -Path "Config.gs" -Pattern "SHEET_ISSUES"</verify>
  <done>SHEET_ISSUES constant exists, HEADERS_ISSUES defined, initStructure creates the sheet.</done>
</task>

<task type="auto">
  <name>Apply all data validation dropdowns in initStructure</name>
  <files>Main.gs</files>
  <action>
    1. After creating PROJECTS sheet, apply Estado dropdown (VALID_STATUSES) to the Estado column of PROJECTS. Use getHeaderMap_ on projectsSheet.
    2. After creating TASKS sheet, apply Proyecto dropdown that references the PROJECTS.Nombre column dynamically. Use a range-based validation: `SpreadsheetApp.newDataValidation().requireValueInRange(projectsSheet.getRange(2, nombreCol, projectsSheet.getMaxRows()-1, 1)).build()`.
    3. Estado dropdown on TASKS already exists — verify it's in the right place.
    4. Wrap each validation in try/catch to prevent init failure.
  </action>
  <verify>Select-String -Path "Main.gs" -Pattern "requireValueInRange", "requireValueInList"</verify>
  <done>PROJECTS.Estado has dropdown, TASKS.Proyecto has dropdown from PROJECTS.Nombre, TASKS.Estado has dropdown.</done>
</task>

## Success Criteria
- [ ] ISSUES sheet created by initStructure with proper headers
- [ ] PROJECTS.Estado has dropdown validation (VALID_STATUSES)
- [ ] TASKS.Proyecto has dropdown validation (from PROJECTS.Nombre range)
- [ ] TASKS.Estado has dropdown validation (VALID_STATUSES) — already done, verify
