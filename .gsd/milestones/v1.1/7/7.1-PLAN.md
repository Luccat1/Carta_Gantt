---
phase: 7
plan: 1
wave: 1
---

# Plan 7.1: DASHBOARD Sheet & KPI Engine

## Objective
Create a `DASHBOARD` sheet that auto-generates key performance indicators from TASKS and PROJECTS data. This provides a portfolio-level overview showing project health, task completion rates, overdue counts, and status breakdowns â€” all computed directly from existing data.

## Context
- Config.gs (sheet constants, HEADERS_TASKS, HEADERS_PROJECTS, VALID_STATUSES)
- Gantt.gs (established pattern for reading TASKS/PROJECTS via header-map)
- Main.gs (initStructure, onOpen menu)
- Helpers.gs (getHeaderMap_, getColIndex_)

## Tasks

<task type="auto">
  <name>Add DASHBOARD constants and sheet initialization</name>
  <files>Config.gs, Main.gs</files>
  <action>
    1. In `Config.gs`, add `var SHEET_DASHBOARD = 'DASHBOARD';`.
    2. In `Main.gs` > `initStructure`:
       - Add step after TIMELINE_DATA to ensure DASHBOARD sheet exists.
       - Apply warning-only protection (same pattern as other auto-generated sheets).
       - No static headers â€” the dashboard is fully script-populated (labels + values side by side).
    3. In `Main.gs` > `onOpen`:
       - Add menu item "Refrescar Dashboard" calling `refreshDashboard`.
       - Place after "Refrescar Timeline".
  </action>
  <verify>grep "SHEET_DASHBOARD" Config.gs && grep "refreshDashboard" Main.gs</verify>
  <done>DASHBOARD sheet is created by initStructure with protection. Menu item present.</done>
</task>

<task type="auto">
  <name>Implement refreshDashboard function</name>
  <files>Gantt.gs</files>
  <action>
    1. Create `refreshDashboard()` in `Gantt.gs`:
       - Clear DASHBOARD sheet.
       - Read all PROJECTS and TASKS data via header-map.
       - Compute and write the following sections:

    **Section A: Portfolio Summary (Row 1-2)**
    - Row 1: Bold title "ðŸ“Š Dashboard"
    - Row 2: "Ãšltima actualizaciÃ³n: [timestamp]"

    **Section B: Global KPIs (Starting Row 4)**
    - Total Proyectos | Total Tareas | Tareas completadas
    - % Completado (Terminado/Total) | Tareas vencidas (Fin < today AND Estado != 'Terminado' AND Estado != 'Cancelado')
    - Use 2-column layout: Label in col A, Value in col B. Bold labels.

    **Section C: Status Breakdown (Starting Row 11)**
    - Title row "Estado de Tareas"
    - One row per VALID_STATUS: StatusName | Count
    - Use col A for status label, col B for count.

    **Section D: Per-Project Summary (Starting after status block)**
    - Title row "Resumen por Proyecto"
    - Headers: Proyecto | Owner | Total Tareas | Completadas | % | Vencidas | Estado
    - One row per project from PROJECTS, with task counts computed from TASKS.

    2. Apply basic formatting:
       - Bold for title rows and section headers.
       - The dashboard recalculates on every call â€” no formulas, just values.

    - Do NOT create charts â€” the dashboard is a data summary sheet that users can optionally chart themselves.
    - Do NOT use VALID_STATUSES as column headers (that would break if statuses change). Use rows instead.
  </action>
  <verify>grep "refreshDashboard" Gantt.gs</verify>
  <done>`refreshDashboard` populates DASHBOARD with Global KPIs, Status Breakdown, and Per-Project Summary. All values are computed from live data.</done>
</task>

## Success Criteria
- [ ] DASHBOARD sheet is created by initStructure
- [ ] `refreshDashboard` computes KPIs from TASKS + PROJECTS
- [ ] Status breakdown counts match actual data
- [ ] Per-project summary shows task counts, completion %, and overdue count
- [ ] Menu item "Refrescar Dashboard" works
