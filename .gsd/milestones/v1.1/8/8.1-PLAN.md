---
phase: 8
plan: 1
wave: 1
---

# Plan 8.1: Auto-Estados (Project Status Engine)

## Objective
Automatically compute the `Estado` field of each project in the PROJECTS sheet based on the aggregate status of its child tasks. This eliminates the need for manual project-status bookkeeping.

**Rules:**
- If ALL tasks are `Terminado` → Project = `Terminado`
- If ANY task is `Bloqueado` → Project = `Bloqueado`
- If ANY task is `En curso` → Project = `En curso`
- If ALL tasks are `No iniciado` → Project = `No iniciado`
- If ALL tasks are `Cancelado` → Project = `Cancelado`
- Mixed (`En curso` + `No iniciado`, no blockers) → `En curso`

## Context
- .gsd/SPEC.md
- Config.gs — VALID_STATUSES, HEADERS_PROJECTS, HEADERS_TASKS
- Main.gs — onOpen menu, initStructure
- Gantt.gs — refreshGanttView (integration point for auto-sync)
- Helpers.gs — getHeaderMap_, getColIndex_

## Tasks

<task type="auto">
  <name>Implement autoUpdateProjectStatuses_ in Gantt.gs</name>
  <files>Gantt.gs</files>
  <action>
    Create a new function `autoUpdateProjectStatuses_()` that:
    1. Reads all tasks from TASKS sheet via getHeaderMap_
    2. Groups tasks by `Proyecto` column
    3. For each project, applies the status resolution rules above
    4. Writes the computed status back to the PROJECTS sheet `Estado` column
    - Use getHeaderMap_ for both sheets to stay column-agnostic
    - Only update projects that actually have tasks; leave orphan projects untouched
  </action>
  <verify>Code review: function exists, uses header mapping, handles all status combinations</verify>
  <done>autoUpdateProjectStatuses_ function implemented with all 6 status rules</done>
</task>

<task type="auto">
  <name>Integrate auto-estados into refreshGanttView and add menu item</name>
  <files>Gantt.gs, Main.gs</files>
  <action>
    1. In Gantt.gs `refreshGanttView()`, add `autoUpdateProjectStatuses_()` call BEFORE `refreshDashboard()` (step 8) so dashboard reflects updated statuses
    2. In Main.gs `onOpen()`, add a standalone menu item "Actualizar estados" calling a public wrapper `updateProjectStatuses()`
    3. Create the public wrapper function `updateProjectStatuses()` in Gantt.gs that calls `autoUpdateProjectStatuses_()` and shows an alert
  </action>
  <verify>Code review: menu item exists, auto-sync call is in the correct order</verify>
  <done>Project statuses auto-update on every Gantt refresh; standalone menu item available</done>
</task>

## Success Criteria
- [ ] Project statuses are computed from child task statuses
- [ ] Auto-update runs on every `refreshGanttView` call
- [ ] Standalone menu item allows manual trigger
